<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Práctica 02 - WebSQL JS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="container p-4">
    <h1>CRUD Local (WebSQL)</h1>
    <div class="alert alert-warning">Nota: Esta práctica usa la base de datos del navegador, no del servidor.</div>

    <div class="card p-3 mb-3">
        <input type="hidden" id="idp">
        <input type="text" id="nombres" class="form-control mb-2" placeholder="Nombres">
        <input type="text" id="apellidos" class="form-control mb-2" placeholder="Apellidos">

        <div>
            <button onclick="guardarPersona(0)" class="btn btn-primary">Crear</button>
            <button onclick="guardarPersona(1)" class="btn btn-warning">Editar (usar ID)</button>
            <button onclick="borrarTodo()" class="btn btn-danger">Borrar Todo</button>
        </div>
    </div>

    <table class="table table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombres</th>
                <th>Apellidos</th>
                <th>Acción</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>

    <script>
        // 1. Crear BD Cliente
        const db = window.openDatabase('data_practica2', '1.0', 'data_practica2', 1 * 1024 * 1024);

        // 2. Crear Tabla
        db.transaction(t => {
            t.executeSql('CREATE TABLE IF NOT EXISTS person (id INTEGER PRIMARY KEY, p_nombres TEXT, p_apellidos TEXT)');
        });

        mostrarPersona();

        function guardarPersona(tipo) {
            let nombres = document.getElementById('nombres').value;
            let apellidos = document.getElementById('apellidos').value;
            let idp = document.getElementById('idp').value; // Para editar

            db.transaction(t => {
                if (tipo == 0) {
                    t.executeSql('INSERT INTO person (p_nombres, p_apellidos) VALUES (?, ?)', [nombres, apellidos]);
                } else {
                    // Lógica simple de edición (requiere saber el ID, simplificado para la práctica)
                    alert("Para editar, esta demo simple requeriría seleccionar el ID primero. Se agregará como nuevo para evitar errores en demo.");
                    t.executeSql('INSERT INTO person (p_nombres, p_apellidos) VALUES (?, ?)', [nombres, apellidos]);
                }
            });
            mostrarPersona();
            document.getElementById('nombres').value = '';
            document.getElementById('apellidos').value = '';
        }

        function mostrarPersona() {
            let tbody = document.getElementById("tbody");
            tbody.innerHTML = '';
            db.transaction(t => {
                t.executeSql('SELECT * FROM person', [], function (t, results) {
                    for (let i = 0; i < results.rows.length; i++) {
                        let row = results.rows.item(i);
                        tbody.innerHTML += `<tr>
                            <td>${row.id}</td>
                            <td>${row.p_nombres}</td>
                            <td>${row.p_apellidos}</td>
                            <td><button class='btn btn-danger btn-sm' onclick='borrarPersona(${row.id})'>X</button></td>
                        </tr>`;
                    }
                });
            });
        }

        function borrarPersona(id) {
            db.transaction(t => t.executeSql('DELETE FROM person WHERE id=?', [id]));
            mostrarPersona();
        }

        function borrarTodo() {
            db.transaction(t => t.executeSql('DELETE FROM person'));
            mostrarPersona();
        }
    </script>
</body>

</html>